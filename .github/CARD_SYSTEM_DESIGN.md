# OSHI-HIGH カードシステム・グランドデザイン

本システムは、「42種の器」、「3層のスキル」、「インタラクティブ・アノテーション」を軸とした、超軽量・高回転型のデジタルカードプラットフォームである。

## 1. カードの基本構成：42種類の器 (The 42 Vessels)

カードは無限に生成せず、以下の数学的組み合わせ（7×2×3=42）に収束させる。

### 1.1 曜日 (7種)
- **月〜日**: サーバー時刻（UTC または JST）に連動してドロップ
- **リアルタイム性**: 曜日境界（00:00 JST）を基準に動的に変更
- **ドロップ確率**: 該当曜日時に出現率が上昇

### 1.2 カラー (2種)
- **⚪️ 白 (Active)**: 昼間・オンタイム用（6:00～18:00）
  - 高アクティビティ向け、即座のアクション推奨
- **⚫️ 黒 (Steady)**: 夜間・オフタイム用（18:00～6:00）
  - 低アクティビティ向け、ステディな保有推奨

### 1.3 属性 (3種)
- **✊ グー**: 攻撃型スキル、ミニゲーム勝率向上
- **✌️ チョキ**: 防御型スキル、ポイント獲得保護
- **✋ パー**: 支援型スキル、コミュニティボーナス

じゃんけん属性は、ミニゲームの勝敗判定およびスキルツリーのリソース配分に使用。

## 2. 広告とブランディング（セルフサーブ型）

### 2.1 枠（フレーム）の概念
- **購買単位**: 企業は「器（曜日×時間帯×色）」の枠をサブスク購入
- **月額料金**: 枠の希少性（曜日・時間帯）に応じて段階的に設定
- **コンテンツ流し込み**: 企業は購買枠にカード画像・メタデータを割り当て

### 2.2 ドットロゴの標準化
- **仕様**: 64×64 ピクセル、16色パレット（最大）
- **自動処理**: アップロード時に自動的にドット絵化、品質最適化
- **品質統一**: 全企業ロゴを統一解像度で表示し、世界観の一貫性を保つ
- **軽量性**: JSON ベースのパレット + インデックス配列で、1枚あたり数KB以下

### 2.3 自浄作用メカニズム
- **即時出稿**: 審査プロセスなし、サブスク開始と同時に配信開始
- **通報システム**: ユーザーが不適切コンテンツを通報可能
- **クッション画面**: 外部リンク遷移前に「離脱予告」スクリーンを表示
- **削除対応**: 通報内容精査後、削除または警告を実施（投稿者責任ベース）

## 3. 3層のスキル構造

各カードには独立した3つの役割を定義。スキルレベルはカード毎に 1～5 段階。

### 3.1 カジノスキル
- **効果**: ミニゲーム（スロット、ポーカー、ジャンケン等）の有利判定
- **機序**: サーバー側乱数生成時に、カードスキルレベルを係数として適用
- **実例**: レベル5 なら通常の 1.5 倍確率で勝利判定

### 3.2 推し活スキル
- **効果**: ポイント（Activity）獲得効率の向上
- **機序**: 推し応援アクション（投票・コメント等）実行時、ボーナス係数を乗算
- **実例**: レベル3 で +20% Activity ボーナス

### 3.3 広告スキル
- **効果**: 企業設定の特別なインタラクティブ機能を解放
- **機序**: カード詳細画面でクイズ・キャンペーン等を企業カスタムで実装可能
- **実例**: レベル2 以上で限定クーポンコード取得機能を解放

## 4. インタラクティブ・アノテーション (Interactive Annotation)

カード詳細画面を「ミニアプリ化」し、企業とユーザーの接点を創出する仕組み。

### 4.1 機能列
- **クイズ**: 企業が設問を設定、正解時にステータス上昇（バフ）
- **アンケート**: ユーザー投票結果をリアルタイム集計表示
- **外部リンク**: WebView またはクッション画面経由で外部サイトへ誘導
- **スクラッチ**: カード表面のスクラッチアニメーション実装

### 4.2 エンゲージメント戦略
- **実利提供**: クイズ正解で一時的なステータスアップ（バフ 15 分）
- **フェアプレイ**: 外部リンク遷移前に「このページから離脱します」画面を表示
- **再訪性**: クイズ・キャンペーンは日替わり化し、毎日新しい刺激を提供

### 4.3 データ仕様
```typescript
interface CardAnnotation {
  cardId: string;
  type: "quiz" | "survey" | "link" | "scratch";
  content: {
    question?: string;
    options?: string[];
    externalUrl?: string;
  };
  rewards?: {
    buffType: "activity" | "casino";
    duration: number; // 秒
  };
}
```

## 5. 技術・運用要件

### 5.1 超軽量データモデル（レシピ方式）
- **サーバー保存**: 画像ファイルではなく「ID の羅列（レシピ）」のみ保存
  ```typescript
  // サーバー側データ例
  {
    cardId: "card_20260119_001",
    dayOfWeek: 1,        // 月曜日
    colorType: 0,        // 白 (Active)
    attribute: 2,        // パー
    paletteId: "p_12",   // カラーパレット ID
    dotSequence: [0,1,1,2,0,2,...] // ピクセルインデックス配列
  }
  ```
- **クライアント合成**: React/Next.js でドット絵再構成、`image-rendering: pixelated` で表示
- **データサイズ削減**: 1 カード = 平均 2～5 KB、月額ストレージコスト最小化

### 5.2 運営方針
- **投稿者責任ベース**: 企業が自社コンテンツの品質管理に責任
- **通報駆動削除**: 事前審査廃止、ユーザー通報に基づく事後対応
- **最小限のガイドライン**: 法令遵守 + 基本的なコンテンツポリシー提示のみ

### 5.3 経済圏バランス
- **平日/休日ドロップ**: 平日は仕事帰り向け（白: Active）、休日は自由時間向け（黒: Steady）
- **トレード機能**: ユーザー間でカードを交換可能、流動性を確保
- **レアリティ**: 曜日×色×属性の組み合わせで自動的に希少性が決定
- **継続率維持**: 定期的なキャンペーン＋ドロップ仕様の多様化で飽和防止

## 6. ロードマップ（実装段階）

### Phase 1: コア認証 & DB 構築（Q1 2026）
- SMS 認証フロー（Firebase Identity Platform）
- ユーザー・企業スキーム設計
- VerificationToken/Account 実装

### Phase 2: カード生成 & 管理（Q2 2026）
- 42 カードセット定義
- ドット絵パレット & レシピシステム
- カード詳細画面実装

### Phase 3: ミニゲーム & インタラクション（Q3 2026）
- じゃんけんゲーム実装
- クイズ・アンケート機能
- ステータス/バフシステム

### Phase 4: 運用・経済圏（Q4 2026）
- サブスク枠販売システム
- トレード機能
- 通報・削除管理画面

## 7. 参考資料・関連ドキュメント

- [GitHub Copilot Instructions](./copilot-instructions.md)
- [Environment Variables Guide](../ENV.md)
- [Database Schema](../prisma/schema.prisma)
- [SMS Authentication Flow](../src/app/api/auth/sms/)

---

**最終更新**: 2026-01-19  
**所有チーム**: OSHI-HIGH コア開発チーム
